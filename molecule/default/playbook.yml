---
- hosts: all
  gather_facts: 'no'
  tasks:
    - name: Install python for Ansible
      raw: test -e /usr/bin/python || (apt -y update && apt install -y python-minimal)
      become: 'yes'
      changed_when: false

- hosts: all
  become: true
  pre_tasks:
    - name: Install python selinux module
      package:
        name: libselinux-python
    - name: Dissable SELinux like in our projects
      selinux:
        state: disabled
    - name: Install required EPEL access for redis packages on CentOS / RedHat.
      yum:
        name: epel-release
      # Required to initialise the cluster
    - name: Install ruby
      package:
        name: ruby
    - name: Install net-tools for testinfra socket testing.
      package:
        name: net-tools
  roles:
    - { name: redis, redis_port: 7000 }
    - { name: redis, redis_port: 7001 }
    - { name: redis, redis_port: 7002 }
    - { name: redis, redis_port: 7003 }
    - { name: redis, redis_port: 7004 }
    - { name: redis, redis_port: 7005 }
    - { name: redis, redis_port: 7006 }
    - { name: redis, redis_port: 7007 }
